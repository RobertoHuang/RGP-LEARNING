# Docker入门

## 脚本安装(官方推荐方式)

```shell
#  环境准备(不管系统版本是多少，Docker要求64位并且CentOS7时内核必须不低于3.10，检查当前内核版本)
# uname -r

# 使用root权限登录系统

# 更新系统包到最新
# yum -y update

# 执行Docker安装脚本，这个脚本会添加docker.repo配置并安装Docker
    # 稳定版
    # curl -fsSL https://get.docker.com/ | sh

    # 预发布版
    # curl -fsSL https://test.docker.com/ | sh

# 启动Docker
# systemctl start docker.service

# 验证Docker已经正常安装
# docker run hello-world
```
## 配置Docker服务
```shell
# 添加dockerRoot用户
# useradd dockerRoot
    # 如果后续要删除用户可使用以下命令
    # userdel -rf dockerRoot
        -f：强制删除用户，即使用户当前已登录
        -r：删除用户的同时，删除与用户相关的所有文件

# 设置dockerRoot用户密码
# passwd dockerRoot

# 将dockerRoot用户添加到docker组下
# usermod -aG docker dockerRoot

# 切换到dockerRoot用户 查看dockerRoot用户是否已经属于docker用户组
# su dockerRoot
$ groups
```
## 解决Docker默认配置文件不存在/不生效
```
# 修改配置文件/lib/systemd/system/docker.service
    # 在Services节点下添加一行
    EnvironmentFile=-/etc/default/docker

    # 修改ExecStart属性，拼接上$DOCKER_OPTS
    ExecStart=/usr/bin/dockerd => ExecStart=/usr/bin/dockerd $DOCKER_OPTS

# 重载
# systemctl daemon-reload

# 验证配置是否成功
    # 修改配置文件
    # vim /etc/default/docker

    # 添加如下配置
    DOCKER_OPTS=" --label name=docker_server"

    # 重启Docker服务
    # systemctl restart docker

    # 查看Docker信息 确认配置是否已生效(确认Labels信息是否已变为配置文件中配置的信息)
    # docker info 
```
## 开启Docker远程访问
```
# 修改配置文件 添加两个host配置
# vim /etc/default/docker
添加内容:-H 0.0.0.0:5555  -H unix:///var/run/docker.sock

# 重启Docker服务
# service docker restart

# 远程连接发送指令
# docker -H 192.168.56.128:5555 images

# 配置DOCKER_HOST环境变量 这样不用在每次发送指令时指定IP地址
# export DOCKER_HOST="tcp://192.168.56.128:5555"
```
## 配置Docker镜像加速器
```
阿里云Docker库首页:https://dev.aliyun.com

# 创建文件夹
# mkdir -p /etc/docker

# 创建配置文件
# tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://rykautv8.mirror.aliyuncs.com"]
}
EOF

# 重载
# systemctl daemon-reload

# 重启Docker服务
# systemctl restart docker
```
